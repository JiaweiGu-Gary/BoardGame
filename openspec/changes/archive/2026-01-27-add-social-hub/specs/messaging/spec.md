## ADDED Requirements

### Requirement: 私聊消息发送
用户 SHALL 能够向好友发送文本消息。

#### Scenario: 发送消息成功
- **WHEN** 用户在聊天窗口输入消息并点击发送
- **THEN** 消息存入数据库
- **AND** 接收方实时收到消息推送

#### Scenario: 非好友无法发送消息
- **WHEN** 用户尝试向非好友发送消息
- **THEN** 系统拒绝发送并提示"只能向好友发送消息"

### Requirement: 消息历史加载
用户 SHALL 能够查看与某好友的历史消息。

#### Scenario: 打开聊天窗口
- **WHEN** 用户点击某好友进入聊天
- **THEN** 系统加载最近 50 条消息（分页）
- **AND** 消息按时间正序排列

#### Scenario: 加载更多历史
- **WHEN** 用户滚动到聊天顶部
- **THEN** 系统加载更早的 50 条消息

### Requirement: 未读消息通知
系统 SHALL 显示未读消息数量。

#### Scenario: 收到新消息时更新红点
- **WHEN** 用户收到好友消息且未打开对应聊天窗口
- **THEN** 悬浮球显示红点
- **AND** 会话列表中该好友显示未读数

#### Scenario: 阅读后清除红点
- **WHEN** 用户打开聊天窗口阅读消息
- **THEN** 该会话的未读数清零
- **AND** 总未读数相应减少

### Requirement: 会话列表
用户 SHALL 能够查看所有进行过对话的好友会话列表。

#### Scenario: 展示会话列表
- **WHEN** 用户打开消息面板
- **THEN** 系统显示有消息记录的好友列表
- **AND** 按最后消息时间倒序排列
- **AND** 每个会话显示最后一条消息预览和未读数
